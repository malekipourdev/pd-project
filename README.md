# مدل تشخیص پلاک خودرو با YOLO: مراحل کامل آماده‌سازی دیتاست و آموزش مدل

**بخشی از پروژه پایان‌نامه: کنترل دسترسی خودرو مبتنی بر اینترنت اشیا با استفاده از تشخیص پلاک و شناسایی چهره**

_مقطع کارشناسی ارشد نرم‌افزار_

[![محصول تجاری](https://img.shields.io/badge/محصول_تجاری-GateVision.ir-success)](https://gatevision.ir/)
[![وضعیت](https://img.shields.io/badge/وضعیت-تکمیل_شده-brightgreen)]()
[![مجوز](https://img.shields.io/badge/مجوز-آزاد-blue)]()

## چکیده

این پروژه مجموعه کاملی از مراحل آماده‌سازی دیتاست، آموزش مدل، و استفاده از مدل تشخیص پلاک خودرو با استفاده از معماری YOLO ارائه می‌دهد. این مدل بخشی از پروژه پایان‌نامه کنترل دسترسی خودرو مبتنی بر اینترنت اشیا است که به صورت عمومی منتشر شده است. دیتاست آماده‌شده در این پروژه می‌تواند مستقیماً به عنوان ورودی به مدل YOLO داده شود.

**نکته مهم:** این پایان‌نامه به یک محصول تجاری موفق با نام [GateVision](https://gatevision.ir/) تبدیل شده است که نشان‌دهنده کاربرد عملی و ارزش تجاری تحقیقات انجام‌شده می‌باشد.

## ساختار پروژه

```
cv-project/
├── dataset.txt                    # توضیحات دیتاست
├── README.md                      # این فایل
├── model/
│   └── best_plate_detection.pt    # مدل آموزش‌دیده نهایی
├── plate_detction/               # مراحل آماده‌سازی دیتاست
│   ├── step1.ipynb           # تبدیل XML به YOLO format
│   ├── step2.ipynb          # نرمال‌سازی مختصات
│   ├── step3.ipynb          # تست و نمایش بندینگ باکس‌ها
│   ├── step4.ipynb          # جداسازی تصاویر
│   ├── step5.ipynb          # تقسیم‌بندی دیتاست
│   └── step6.ipynb          # ایجاد فایل کانفیگ YAML
└── sample_usage/
    └── 1_test_plate_detction.ipynb # نمونه استفاده از مدل
```

## مقدمه

تشخیص پلاک خودرو یکی از مباحث مهم در بینایی کامپیوتر و کاربردهای اینترنت اشیا محسوب می‌شود. این پروژه بخشی از یک سیستم جامع کنترل دسترسی خودرو است که ترکیبی از تشخیص پلاک و شناسایی چهره برای اعتبارسنجی کاربران استفاده می‌کند.

## متدولوژی

### ۱. آماده‌سازی دیتاست

دیتاست اولیه شامل تصاویر خودروها با annotation های XML بود که برای آموزش مدل YOLO باید به فرمت YOLO تبدیل شوند. مراحل آماده‌سازی به شرح زیر است:

#### مرحله ۱: تبدیل XML به فرمت YOLO (`step1.ipynb`)

**هدف:** تبدیل فایل‌های annotation با فرمت XML به فرمت YOLO

**فرآیند:**

- خواندن فایل‌های XML حاوی مختصات بندینگ باکس‌ها
- استخراج کلاس "کل ناحیه پلاک" از annotation ها
- تبدیل مختصات `(xmin, ymin, xmax, ymax)` به فرمت YOLO `(x_center, y_center, width, height)`
- ذخیره نتایج در فایل‌های TXT با فرمت YOLO

**کد کلیدی:**

```python
x_center = (x_min + x_max) / 2
y_center = (y_min + y_max) / 2
width = x_max - x_min
height = y_max - y_min
```

**توضیحات تکمیلی:**
این مرحله اساسی‌ترین قدم در آماده‌سازی دیتاست است. فایل‌های XML حاوی annotation های دستی یا نیمه‌خودکار هستند که مختصات پلاک‌ها را به صورت مستطیلی مشخص می‌کنند. YOLO به جای استفاده از گوشه‌های مستطیل، از مرکز و ابعاد استفاده می‌کند.

#### مرحله ۲: نرمال‌سازی مختصات (`step2.ipynb`)

**هدف:** نرمال‌سازی مختصات بر اساس ابعاد تصویر

**فرآیند:**

- خواندن ابعاد هر تصویر
- تقسیم مختصات x بر عرض تصویر
- تقسیم مختصات y بر ارتفاع تصویر
- ذخیره مختصات نرمال‌شده (بین ۰ تا ۱)

**فرمول نرمال‌سازی:**

```python
x_center_norm = x_center / img_width
y_center_norm = y_center / img_height
width_norm = width / img_width
height_norm = height / img_height
```

**اهمیت نرمال‌سازی:**
YOLO نیاز به مختصات نرمال‌شده دارد تا بتواند با تصاویر با ابعاد مختلف کار کند. این امر باعث می‌شود مدل قابل تعمیم‌تر باشد و بتواند روی تصاویر با وضوح‌های مختلف عمل کند.

#### مرحله ۳: تست و نمایش (`step3.ipynb`)

**هدف:** اعتبارسنجی صحت annotation ها

**فرآیند:**

- بارگذاری تصویر نمونه
- خواندن annotation نرمال‌شده
- تبدیل مجدد به مختصات پیکسلی
- رسم بندینگ باکس روی تصویر
- نمایش تصویر با matplotlib

**کاربرد:** اطمینان از صحت فرآیند تبدیل annotation ها

**نکته مهم:** این مرحله برای اطمینان از صحت فرآیند تبدیل ضروری است. بسیاری از خطاهای آموزش مدل به دلیل اشتباه در annotation ها رخ می‌دهد.

#### مرحله ۴: جداسازی تصاویر (`step4.ipynb`)

**هدف:** جداسازی فایل‌های تصویری از سایر فایل‌ها

**فرآیند:**

- جستجوی فایل‌های با پسوند JPG
- کپی کردن تصاویر به پوشه جداگانه
- آماده‌سازی برای مرحله تقسیم‌بندی

**دلیل ضرورت:** سازماندهی فایل‌ها برای مراحل بعدی و جلوگیری از اختلاط فایل‌های تصویری با annotation ها.

#### مرحله ۵: تقسیم‌بندی دیتاست (`step5.ipynb`)

**هدف:** تقسیم دیتاست به سه بخش train، validation، و test

**نسبت تقسیم‌بندی:**

- Train: ۸۰٪ (برای آموزش مدل)
- Validation: ۱۰٪ (برای تنظیم هایپرپارامترها)
- Test: ۱۰٪ (برای ارزیابی نهایی)

**فرآیند:**

- مخلوط کردن تصادفی فایل‌ها
- تقسیم‌بندی بر اساس نسبت‌های تعیین‌شده
- انتقال فایل‌های تصویر و label مربوطه به پوشه‌های مناسب

**اهمیت تقسیم‌بندی صحیح:**

- تقسیم‌بندی تصادفی جلوگیری از overfitting می‌کند
- validation set برای کنترل فرآیند آموزش استفاده می‌شود
- test set برای ارزیابی نهایی و غیرجانبدارانه عملکرد مدل

#### مرحله ۶: ایجاد فایل کانفیگ (`step6.ipynb`)

**هدف:** ایجاد فایل `data.yaml` برای آموزش YOLO

**محتوای فایل کانفیگ:**

```yaml
train: dataset/images/train
val: dataset/images/val
test: dataset/images/test
nc: 1 # تعداد کلاس‌ها
names: ["license_plate"] # نام کلاس‌ها
```

**اهمیت فایل کانفیگ:**
این فایل به YOLO اطلاعات ضروری درباره ساختار دیتاست و کلاس‌ها را می‌دهد. بدون این فایل، آموزش مدل امکان‌پذیر نیست.

### ۲. آموزش مدل

با استفاده از دیتاست آماده‌شده، مدل YOLO آموزش داده شد. مراحل آموزش شامل:

**پارامترهای آموزش:**

- نوع مدل: YOLOv8 یا نسخه مشابه
- تعداد epoch ها: بر اساس convergence مدل
- learning rate: تنظیم‌شده برای بهینه‌سازی
- batch size: بر اساس محدودیت‌های سخت‌افزاری

**نتیجه:** مدل نهایی در فایل `best_plate_detection.pt` ذخیره شد.

### ۳. استفاده از مدل

#### نمونه استفاده (`1_test_plate_detction.ipynb`)

**قابلیت‌ها:**

- بارگذاری مدل آموزش‌دیده
- تشخیص پلاک در تصاویر جدید
- رسم بندینگ باکس با درجه اطمینان
- برش و ذخیره ناحیه پلاک

**کد نمونه:**

```python
from ultralytics import YOLO
import cv2
import matplotlib.pyplot as plt

# بارگذاری مدل
model = YOLO("../model/best_plate_detection.pt")

# تشخیص پلاک
results = model(image_path)

# پردازش نتایج
for result in results:
    for box in result.boxes:
        x_min, y_min, x_max, y_max = map(int, box.xyxy[0])
        confidence = box.conf[0].item()

        # رسم بندینگ باکس
        cv2.rectangle(image, (x_min, y_min), (x_max, y_max), (0, 255, 0), 2)
        cv2.putText(image, f"{confidence:.2f}", (x_min, y_min - 5),
                    cv2.FONT_HERSHEY_SIMPLEX, 0.5, (0, 255, 0), 2)

        # برش پلاک
        cropped_plate = image[y_min:y_max, x_min:x_max]
        cv2.imwrite(f"cropped_plate_{crop_count}.jpg", cropped_plate)
```

## نتایج و ارزیابی

### عملکرد مدل

مدل آموزش‌دیده قابلیت‌های زیر را دارد:

- تشخیص پلاک‌های خودرو با دقت مناسب
- کار کردن با تصاویر با وضوح‌های مختلف
- ارائه درجه اطمینان برای هر تشخیص
- سرعت مناسب برای کاربردهای real-time

### معیارهای ارزیابی

- **Precision:** نسبت تشخیص‌های صحیح به کل تشخیص‌ها
- **Recall:** نسبت تشخیص‌های صحیح به کل پلاک‌های موجود
- **mAP (mean Average Precision):** معیار جامع ارزیابی
- **Inference Time:** زمان تشخیص هر تصویر

## نصب و راه‌اندازی

### پیش‌نیازها

**کتابخانه‌های اصلی:**

```bash
pip install ultralytics opencv-python matplotlib torch torchvision
```

**کتابخانه‌های کمکی:**

```bash
pip install numpy pandas pillow pyyaml
```

### مراحل نصب کامل

1. **کلون کردن پروژه:**

```bash
git clone [repository-url]
cd cv-project
```

2. **نصب dependencies:**

```bash
pip install -r requirements.txt
```

3. **تست مدل:**

```bash
python sample_usage/test_model.py
```

### استفاده از مدل

#### استفاده ساده:

```python
from ultralytics import YOLO

# بارگذاری مدل
model = YOLO("model/best_plate_detection.pt")

# تشخیص پلاک
results = model("path/to/your/image.jpg")

# نمایش نتایج
results[0].show()
```

#### استفاده پیشرفته:

```python
import cv2
import numpy as np
from ultralytics import YOLO

def detect_plates(image_path, confidence_threshold=0.5):
    """
    تشخیص پلاک در تصویر

    Args:
        image_path: مسیر تصویر
        confidence_threshold: آستانه اطمینان

    Returns:
        list: لیست پلاک‌های شناسایی شده
    """
    model = YOLO("model/best_plate_detection.pt")
    results = model(image_path, conf=confidence_threshold)

    plates = []
    for result in results:
        for box in result.boxes:
            x1, y1, x2, y2 = map(int, box.xyxy[0])
            confidence = float(box.conf[0])
            plates.append({
                'bbox': (x1, y1, x2, y2),
                'confidence': confidence
            })

    return plates

# استفاده
plates = detect_plates("test_image.jpg", 0.7)
print(f"تعداد پلاک‌های شناسایی شده: {len(plates)}")
```

## کاربردها

### ۱. سیستم‌های کنترل دسترسی

- **ورود به پارکینگ‌ها:** شناسایی خودروهای مجاز
- **گیت‌های امنیتی:** کنترل دسترسی به مناطق محدود
- **ساختمان‌های اداری:** مدیریت ورود کارکنان

### ۲. سیستم‌های پارکینگ هوشمند

- **ثبت ورود و خروج:** ثبت خودکار زمان‌ها
- **محاسبه هزینه:** بر اساس مدت پارک
- **مدیریت ظرفیت:** کنترل تعداد خودروها

### ۳. نظارت ترافیک

- **کنترل سرعت:** ترکیب با سیستم‌های رادار
- **شناسایی تخلفات:** ثبت تخلفات رانندگی
- **آمارگیری ترافیک:** تحلیل الگوهای رفت و آمد

### ۴. کاربردهای امنیتی

- **شناسایی خودروهای مشکوک:** مقایسه با لیست سیاه
- **ردیابی خودروها:** پیگیری مسیر حرکت
- **تحلیل رفتار:** شناسایی الگوهای غیرعادی



## بهینه‌سازی و تنظیمات

### تنظیم آستانه اطمینان

```python
# آستانه‌های مختلف برای شرایط مختلف
confidence_thresholds = {
    'high_quality': 0.8,    # تصاویر با کیفیت بالا
    'normal': 0.5,          # شرایط عادی
    'low_light': 0.3,       # نور کم
    'distant': 0.4          # فاصله زیاد
}
```

### بهینه‌سازی سرعت

```python
# تنظیمات برای سرعت بالا
model = YOLO("model/best_plate_detection.pt")
model.model.eval()  # حالت evaluation
model.overrides['verbose'] = False  # حذف پیام‌ها

# استفاده از GPU در صورت وجود
if torch.cuda.is_available():
    model.to('cuda')
```

## مقایسه با روش‌های دیگر

### مزایای YOLO نسبت به سایر روش‌ها

1. **سرعت:** تشخیص real-time
2. **دقت:** عملکرد مناسب در شرایط مختلف
3. **سادگی:** استفاده آسان و مستندات کامل
4. **انعطاف:** قابل تنظیم برای کاربردهای مختلف

### مقایسه با Classical Computer Vision

| معیار         | YOLO | Classical CV |
| ------------- | ---- | ------------ |
| دقت           | بالا | متوسط        |
| سرعت          | بالا | متوسط        |
| تنظیم پارامتر | کم   | زیاد         |
| نیاز به دیتا  | زیاد | کم           |

## آینده پژوهش

### بهبودهای پیشنهادی

1. **تشخیص متن پلاک:**

   - اضافه کردن OCR برای خواندن محتوای پلاک
   - ترکیب با مدل‌های تشخیص کاراکتر

2. **تشخیص چندگانه:**

   - تشخیص همزمان پلاک و سایر اجزای خودرو
   - شناسایی نوع خودرو

3. **بهبود در شرایط سخت:**

   - کار روی تصاویر شبانه
   - تشخیص در شرایط جوی نامساعد

4. **کاهش حجم مدل:**
   - استفاده از model quantization
   - طراحی مدل‌های سبک‌تر برای کاربردهای موبایل

## نتیجه‌گیری

این پروژه مجموعه کاملی از مراحل آماده‌سازی دیتاست برای آموزش مدل YOLO جهت تشخیص پلاک ارائه می‌دهد. ویژگی‌های کلیدی این پروژه عبارتند از:

1. **جامعیت:** تمام مراحل از آماده‌سازی دیتا تا استفاده از مدل
2. **قابلیت استفاده مجدد:** دیتاست آماده برای YOLO
3. **مستندات کامل:** توضیح مفصل هر مرحله
4. **کاربردی بودن:** قابل استفاده در پروژه‌های واقعی
5. **موفقیت تجاری:** تبدیل به محصول [GateVision](https://gatevision.ir/)

### نکات کلیدی

- **کیفیت دیتاست:** پایه و اساس موفقیت مدل
- **تنظیمات صحیح:** اهمیت تنظیم پارامترها
- **تست مداوم:** ضرورت آزمایش در شرایط مختلف
- **بهینه‌سازی:** امکان بهبود مداوم عملکرد

### کاربرد در پروژه اصلی

این مدل بخشی از سیستم جامع کنترل دسترسی است که شامل:

- **تشخیص پلاک:** مرحله اول شناسایی
- **شناسایی چهره:** تأیید هویت راننده
- **اینترنت اشیا:** ارتباط با سیستم‌های کنترل
- **پایگاه داده:** مدیریت اطلاعات کاربران

## محصول تجاری

این پایان‌نامه به یک محصول تجاری تبدیل شده است:

### 🚀  سیستم کنترل دسترسی هوشمند | GateVision

**وب‌سایت:** [https://gatevision.ir/](https://gatevision.ir/)

**ویژگی‌های محصول تجاری:**

- سیستم کامل کنترل دسترسی خودرو
- ترکیب تشخیص پلاک و شناسایی چهره
- پلتفرم اینترنت اشیا برای مدیریت
- رابط کاربری وب و موبایل
- گزارش‌گیری و تحلیل داده‌ها
- پشتیبانی و نصب تخصصی

این پروژه نمونه‌ای از تبدیل موفق یک پایان‌نامه تحقیقاتی به محصول تجاری است که نشان می‌دهد کاربرد عملی تحقیقات دانشگاهی در حل مشکلات واقعی جامعه.

## ارتباط با نویسنده

این پروژه بخش عمومی از پایان‌نامه کارشناسی ارشد نرم‌افزار در زمینه کنترل دسترسی خودرو مبتنی بر اینترنت اشیا است.

### اطلاعات تماس

- **موضوع پایان‌نامه:** کنترل دسترسی خودرو مبتنی بر اینترنت اشیا با استفاده از تشخیص پلاک و شناسایی چهره
- **مقطع:** کارشناسی ارشد نرم‌افزار
- **وضعیت:** بخش تشخیص پلاک - عمومی
- **محصول تجاری:** [GateVision.ir](https://gatevision.ir/)

### مجوز استفاده

این پروژه تحت مجوز آزاد قرار دارد و می‌تواند در پروژه‌های تحقیقاتی و آموزشی استفاده شود.
